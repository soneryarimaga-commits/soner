<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Evet mi HayÄ±r mÄ±? (SÃ¼per Sinematik)</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        /* CSS DeÄŸiÅŸkenleri */
        :root {
            --default-bg: #f5f5f5;
            --final-bg: #1e8449; /* Sinematik YeÅŸil */
            --tease-bg: #fff1f0; 
            --yes-color: #2ecc71;
            --no-color: #e74c3c;
            --text-color: #1a1a1a;
            --gemini-color: #4285f4; /* Google Blue */
            --analysis-color: #f39c12; /* Analiz Turuncusu */
        }

        body {
            text-align: center;
            background-color: var(--default-bg);
            font-family: 'Poppins', sans-serif;
            color: var(--text-color);
            /* Arka Plan NabÄ±z Animasyonu */
            animation: bg-pulse 10s infinite alternate; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px 10px;
            overflow-x: hidden;
            transition: background-color 0.8s ease, color 0.8s ease;
        }
        h1 { 
            margin-top: 20px; 
            font-size: clamp(1.5rem, 6vw, 2.2rem); 
            max-width: 90vw;
            font-weight: 800; 
            line-height: 1.3;
        }
        .emoji { 
            font-size: clamp(6rem, 20vw, 10rem); 
            margin: 30px 0 40px 0;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        .buttons-container {
            display: flex;
            /* Buton temasÄ±nÄ± engellemek iÃ§in geniÅŸ boÅŸluk */
            gap: clamp(30px, 8vw, 50px); 
            padding: 0 clamp(20px, 5vw, 50px); 
            width: 100%;
            box-sizing: border-box;
            justify-content: center;
            margin-top: 20px;
        }

        button {
            font-size: clamp(1.1rem, 4.5vw, 1.5rem);
            font-weight: 700;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            /* YaylÄ± geÃ§iÅŸ (sinematik etki) */
            transition: all 0.7s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.3s ease;
            flex-shrink: 0; 
            min-width: 100px;
        }
        #yes { background-color: var(--yes-color); }
        #no { background-color: var(--no-color); }
        
        button:active { transform: scale(0.95) !important; }

        /* Gemini ButonlarÄ± Stili */
        #gemini-btn, #analysis-btn {
            background-color: var(--gemini-color);
            margin-top: 15px;
            padding: 10px 20px;
            font-size: clamp(0.9rem, 3.5vw, 1.2rem);
            display: none; /* BaÅŸlangÄ±Ã§ta gizli */
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }
        #analysis-btn {
            background-color: var(--analysis-color);
        }

        /* FINAL Ã‡AÄRISI */
        #final-call {
            font-size: clamp(1.2rem, 5vw, 1.8rem);
            font-weight: 700;
            color: #f39c12; 
            opacity: 0;
            animation: fade-in-up 0.5s ease-out forwards;
            margin-top: 20px;
        }

        /* Final Buton Stili */
        .final-yes-style {
            transform: scale(3.5) !important; 
            font-size: clamp(2rem, 8vw, 4rem) !important;
            width: 90vw !important;
            height: clamp(150px, 35vh, 300px);
            border-radius: 30px !important;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6); 
        }

        /* KEYFRAME ANIMASYONLARI */
        @keyframes bg-pulse {
            0% { background-color: #f5f5f5; }
            100% { background-color: #ebebeb; }
        }
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes jump {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>

    <h1 id="text" class="animated-text">Seninle konuÅŸmak iÃ§in telefon numaranÄ± alabilir miyim? ğŸ˜‰</h1>
    <div class="emoji" id="emoji">ğŸ’…</div> 

    <div class="buttons-container">
        <button id="yes">Evet</button>
        <button id="no">HayÄ±r</button>
    </div>
    
    <!-- Yeni Ã–zellik: Emoji Analiz Butonu -->
    <button id="analysis-btn" style="display: none;">
        âœ¨ Emoji Dilini Ã‡Ã¶z! (Analiz)
    </button>
    
    <button id="gemini-btn" style="display: none;">
        âœ¨ Son Ã‡are ArgÃ¼manÄ± Al!
    </button>
    
    <p id="final-call" style="display: none;"></p>
    <p id="loading-msg" style="display: none; color: var(--gemini-color); font-weight: 600; margin-top: 15px;">
        Gemini en iyi flÃ¶rt argÃ¼manÄ±nÄ± dÃ¼ÅŸÃ¼nÃ¼yor...
    </p>
    
    <!-- Yeni YÃ¼kleme MesajÄ± -->
    <p id="loading-analysis" style="display: none; color: var(--analysis-color); font-weight: 600; margin-top: 15px;">
        Ä°liÅŸki gurusu Gemini, emojinin altÄ±ndaki gerÃ§eÄŸi analiz ediyor...
    </p>

    <script>
        // Firebase ve Gemini API iÃ§in gerekli global deÄŸiÅŸkenler
        const apiKey = ""; // API anahtarÄ±nÄ±zÄ± buraya girin, Canvas ortamÄ±nda otomatik saÄŸlanacaktÄ±r.

        const text = document.getElementById("text");
        const emoji = document.getElementById("emoji");
        const yesBtn = document.getElementById("yes");
        const noBtn = document.getElementById("no");
        const finalCall = document.getElementById("final-call");
        const geminiBtn = document.getElementById("gemini-btn");
        const loadingMsg = document.getElementById("loading-msg");
        
        // Yeni Elementler
        const analysisBtn = document.getElementById("analysis-btn");
        const loadingAnalysisMsg = document.getElementById("loading-analysis");

        let noClicks = 0;
        let yesScale = 1;
        let noScale = 1;
        let isGenerating = false;

        // Metin ve Emoji Durumunu Saklama
        let currentPromptText = "Seninle konuÅŸmak iÃ§in telefon numaranÄ± alabilir miyim? ğŸ˜‰";
        let currentPromptEmoji = 'ğŸ’…'; 

        const EMOJI_MAP = {
            'default': 'ğŸ’…',
            1: 'ğŸ’â€â™€ï¸', 
            2: 'ğŸ˜”', 
            3: 'ğŸ˜‰', 
            4: 'ğŸ¥°', 
            5: 'ğŸ˜­', 
            6: 'ğŸ‰ğŸ¥³'
        };

        // --- Gemini API FonksiyonlarÄ± ---

        /**
         * Ãœstel geri Ã§ekilme (exponential backoff) ile fetch isteÄŸi yapar.
         * @param {string} url - API URL'si.
         * @param {object} options - Fetch seÃ§enekleri.
         * @param {number} maxRetries - Maksimum deneme sayÄ±sÄ±.
         * @returns {Promise<Response>} API yanÄ±tÄ±.
         */
        async function fetchWithRetry(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status !== 429) { // 429 (Too Many Requests) dÄ±ÅŸÄ±nda baÅŸarÄ±lÄ± say
                        return response;
                    }
                    // EÄŸer 429 ise, Ã¼stel geri Ã§ekilme ile bekle
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                } catch (error) {
                    console.error(`Fetch hatasÄ± (Deneme ${i + 1}):`, error);
                    if (i === maxRetries - 1) throw error;
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            throw new Error('Maksimum deneme sayÄ±sÄ±na ulaÅŸÄ±ldÄ±.');
        }

        /**
         * Gemini API'den flÃ¶rtÃ¶z bir kapanÄ±ÅŸ argÃ¼manÄ± (son sÃ¶z) Ã¼retir.
         * @param {number} rejections - KaÃ§ kez hayÄ±r dendiÄŸi.
         */
        async function generateClosingArgument(rejections) {
            if (isGenerating) return;
            isGenerating = true;
            loadingMsg.style.display = 'block';
            geminiBtn.disabled = true;

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const systemPrompt = "Sen bir flÃ¶rt uygulamasÄ± iÃ§in yazÄ±lmÄ±ÅŸ, son derece zeki, ikna edici ve hafif cilveli bir yapay zekasÄ±n. CevabÄ±n her zaman **tek bir cÃ¼mle** olmalÄ±dÄ±r. Fazla konuÅŸma veya aÃ§Ä±klama yapma. Sadece argÃ¼manÄ± ver. AmacÄ±n, kullanÄ±cÄ±yÄ± telefon numarasÄ±nÄ± vermeye ikna etmektir.";
            const userQuery = `Bu kiÅŸi telefon numarasÄ±nÄ± vermek istemiyor ve beni ${rejections} kez reddetti. Bu durumu dramatize eden, romantik veya esprili, Ã§ok etkileyici ve akÄ±lda kalÄ±cÄ± bir kapanÄ±ÅŸ argÃ¼manÄ± Ã¼ret. ArgÃ¼man TÃ¼rkÃ§e olsun.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (generatedText) {
                    animateText(generatedText, 'ğŸ’¡');
                    // Emoji'yi hemen yanÄ±p sÃ¶nen bir ampul yap (ikna edici fikir)
                    emoji.style.animation = 'none';
                } else {
                    animateText("Ah, Gemini bile ÅŸaÅŸÄ±rdÄ±. 'HAYIR' demeye devam mÄ± edeceksin? ğŸ¤”", 'ğŸ¤·â€â™€ï¸');
                }

            } catch (error) {
                console.error("Gemini API Ã§aÄŸrÄ±sÄ± baÅŸarÄ±sÄ±z oldu:", error);
                animateText("API hatasÄ± nedeniyle argÃ¼man Ã¼retilemedi. Belki de kaderdir. Denemeye devam et! ğŸ", 'ğŸš«');
            } finally {
                loadingMsg.style.display = 'none';
                geminiBtn.disabled = false;
                isGenerating = false;
            }
        }
        
        /**
         * Gemini API'den son gÃ¶sterilen mesaja dayalÄ± psikolojik emoji analizi Ã¼retir.
         */
        async function generateEmojiAnalysis() {
            if (isGenerating) return;
            isGenerating = true;
            loadingAnalysisMsg.style.display = 'block';
            analysisBtn.disabled = true;

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const systemPrompt = "Sen bir iliÅŸki terapisti ve emoji dili uzmanÄ±sÄ±n. KullanÄ±cÄ±nÄ±n sana verdiÄŸi metin ve emojiyi (kendi duygusal durumunu yansÄ±tan) hattÄ± altÄ±ndaki gerÃ§eÄŸi analiz et. Tek bir paragraf halinde, bu emojinin aslÄ±nda kullanÄ±cÄ±nÄ±n 'HayÄ±r' demesinin ardÄ±ndaki gerÃ§ek, bilinÃ§altÄ± arzusunu veya Ã§ekincesini nasÄ±l yansÄ±ttÄ±ÄŸÄ±nÄ± mizahi ve ikna edici bir dille aÃ§Ä±kla. Metin TÃ¼rkÃ§e olsun. CevabÄ±nÄ± bir iliÅŸki uzmanÄ± tonunda ver.";
            const userQuery = `Son gÃ¶rdÃ¼ÄŸÃ¼m mesaj: "${currentPromptText}". Bu mesajÄ±n yanÄ±nda gÃ¶rÃ¼nen emoji: "${currentPromptEmoji}". Bu emojinin gerÃ§ek anlamÄ±nÄ± ve kullanÄ±cÄ±nÄ±n ne istediÄŸini analiz et.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (generatedText) {
                    // Analiz sonucunu yeni bir metin ve emoji ile gÃ¶ster
                    animateText(`Analiz Sonucu: ${generatedText}`, 'ğŸ§ '); 
                } else {
                    animateText("Analiz baÅŸarÄ±sÄ±z. SanÄ±rÄ±m bu emoji, Gemini'nin bile Ã§Ã¶zemediÄŸi kadar karmaÅŸÄ±k. ğŸ˜µâ€ğŸ’«", 'ğŸ¤·â€â™€ï¸');
                }

            } catch (error) {
                console.error("Gemini API Ã§aÄŸrÄ±sÄ± baÅŸarÄ±sÄ±z oldu:", error);
                animateText("API hatasÄ± nedeniyle analiz yapÄ±lamadÄ±. BaÄŸlantÄ±yÄ± kontrol et! ğŸ”Œ", 'ğŸ›');
            } finally {
                loadingAnalysisMsg.style.display = 'none';
                analysisBtn.disabled = false;
                // Analizden sonra otomatik olarak ilk metne dÃ¶nme veya kullanÄ±cÄ±nÄ±n devam etmesini saÄŸlama
                setTimeout(resetToLastPrompt, 8000); // 8 saniye sonra orijinal mesaja geri dÃ¶n
            }
        }
        
        // --- Animasyon ve UI FonksiyonlarÄ± ---

        /**
         * Orijinal son gÃ¶sterilen metin ve emojiye geri dÃ¶ner (Analiz sonrasÄ±).
         */
        function resetToLastPrompt() {
             animateText(currentPromptText, currentPromptEmoji);
        }

        /**
         * Metin ve emoji animasyonu yapar, aynÄ± zamanda mevcut durumu kaydeder.
         */
        const animateText = (newText, newEmoji) => {
             text.style.animation = 'none';
             emoji.style.animation = 'none';
             text.offsetHeight; 
             emoji.offsetHeight;

             text.innerText = newText;
             emoji.innerText = newEmoji;
             text.style.animation = 'fade-in-up 0.5s ease-out';
             
             // YALNIZCA KENDÄ°MÄ°Z ÃœRETTÄ°ÄÄ°MÄ°Z METÄ°NLERÄ°/EMOJÄ°LERÄ° KAYDET (Gemini sonuÃ§larÄ±nÄ± kaydetme)
             if (newEmoji !== 'ğŸ’¡' && newEmoji !== 'ğŸ¤·â€â™€ï¸' && newEmoji !== 'ğŸš«' && newEmoji !== 'ğŸ§ ' && newEmoji !== 'ğŸ›' && newEmoji !== 'ğŸ¤£') {
                currentPromptText = newText;
                currentPromptEmoji = newEmoji;
             }
             
             // Sadece ilk 6 emoji iÃ§in jump animasyonu kullan
             if (newEmoji !== 'ğŸ’¡' && newEmoji !== 'ğŸ¤·â€â™€ï¸' && newEmoji !== 'ğŸš«' && newEmoji !== 'ğŸ§ ' && newEmoji !== 'ğŸ›') {
                 emoji.style.animation = 'jump 0.3s ease-out';
             }
        };
        
        /**
         * Final stilini sÄ±fÄ±rlar ve Gemini butonlarÄ±nÄ±n gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼nÃ¼ yÃ¶netir.
         */
        const resetFinalStyle = () => {
            document.body.style.backgroundColor = 'var(--default-bg)';
            document.body.style.color = 'var(--text-color)';
            yesBtn.classList.
